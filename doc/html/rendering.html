<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.6"/>
<title>Voxels Library: Rendering</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
  $(window).load(resizeHeight);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname">Voxels Library
   &#160;<span id="projectnumber">0.6</span>
   </div>
   <div id="projectbrief">Voxel grid manipulation and surface generation library (c) 2014 Stoyan Nikolov</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.6 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li class="current"><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('rendering.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Classes</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Pages</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">Rendering </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><h2>Feeding the GPU</h2>
<p>The vertices and indices available through the <em><a class="el" href="class_voxels_1_1_polygon_surface.html">Voxels::PolygonSurface</a></em> object must be uploaded to the graphics API. <b>Voxels</b> is graphics API agnostic, so the client is in charge of uploading data to the GPU and drawing it.</p>
<h2>Rendering with LOD</h2>
<p>After polygonization <b>Voxels</b> outputs a set of <em>blocks</em> in LOD levels. LOD level 0 is the most detailed with each subsequent level having half the detail of the previous. The number of blocks in the levels is also different and blocks in a coarser level have twice the physical size on every axis of blocks in a more detailed one. For instance in a block of level 1 fit 8 blocks of level 0.</p>
<p>To save GPU resources we would like to draw blocks with high level of detail near the virtual camera in the scene and coarser blocks in the distance. The client application has to implement a culling mechanism and an algorithm that makes use of the LOD levels to maximise performance but preserve the visual quality of the surface.</p>
<p>A sample implementation of a class that selects LOD blocks on runtime named <b>VoxelLodOctree</b> is provided in the samples. It builds on octree from the output blocks and on each frame it decides which blocks to draw depending on the camera position in the world. It also does frustum culling so blocks that are not seen by the camera are not drawn.</p>
<p><b>Note:</b> You should never have blocks that differ more than 1 LOD level drawn as neighbours, otherwise cracks may appear.</p>
<h2>Transition meshes</h2>
<p>When two blocks of different LOD level are rendered next to each other, cracks might appear between them. This happens because the blocks represent different approximations of the underlying surface. The TransVoxel algorithm and its <b>Voxels</b> implementation fix this by introducing <em>transition meshes</em> between levels.</p>
<p>Each block of LOD level &gt; 0 has up to 6 (because a cube has 6 sides) transition meshes associated with it. Upon drawing if a block of level &gt; 0 has a direct neighbour of a finer level you must draw the transition mesh for the face they share. The transition mesh will fill the eventual cracks that otherwise will generate visual artefacts.</p>
<p>Transition meshes are generated only for combinations of blocks that differ of LOD by one level. That means that if block of level 3 is next to one of level 2, you must draw the transition of the level 3 block for the face it shared with the level 2 one. However to keep computations and combinations fast there are no transition cells generated for LOD differences &gt; 2. You should never allow for blocks with LOD difference &gt; 2 to be drawn next to each other, cracks will appear if you do.</p>
<p>When drawing next to each other blocks with the same level they can be drawn normally. When drawing a block with any transition however, care should be taken. All vertices on the boundary between the levels must be "moved back" a little in order to leave space for the transition mesh and prevent z-fighting. For every block a secondary set of vertices is generated by <b>Voxels</b>. In the W component of the secondary vertex a special mask value is saved that helps selecting either the primary or secondary vertex in the vertex shader.</p>
<p>For DirectX this can be accomplished with the following code in the vertex shader:</p>
<div class="fragment"><div class="line">float4 SelectPositionCell(<span class="keywordtype">int</span> vertexAdj, <span class="keywordtype">int</span> blockAdj, float4 primary, float4 secondary) {</div>
<div class="line">    <span class="keywordflow">if</span>(vertexAdj &amp;&amp; ((vertexAdj &amp; blockAdj) == vertexAdj)) {</div>
<div class="line">        <span class="keywordflow">return</span> float4(secondary.xyz, 1);</div>
<div class="line">    } <span class="keywordflow">else</span> {</div>
<div class="line">        <span class="keywordflow">return</span> primary;     </div>
<div class="line">    }</div>
<div class="line">}</div>
</div><!-- fragment --><p>In this code <em>vertexAdj</em> is the <em>w</em> component of the <em>SecondaryVertex</em> of the block. The <em>blockAdj</em> is a uniform constant passed by the application for each block with information which transitions are drawn this frame for this block.</p>
<p>For more information and sample usage please refer to the example applications accompanying <b>Voxels</b>.</p>
<h2>Texturing</h2>
<p>Surfaces generated by <b>Voxels</b> are designed to be textured via triplanar texturing. Please refer to the <em>Materials</em> section for more details. </p>
</div></div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated on Sun May 11 2014 10:35:37 for Voxels Library by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.6 </li>
  </ul>
</div>
</body>
</html>
